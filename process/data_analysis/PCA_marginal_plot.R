
# Input the data
F10_1 <- c(0.0537373, 0.0612638, 0.093546, 0.084053, 0.00935762, 0.0428651, 0.0637226, 0.174564, 0.0214135, 0.018647, 0.0296789, 0.0678227, 0.0115938, 0.0156217, 0.0319317, 0.127305, 0.0416943, 0.00867762, 0.0107713, 0.031733)
F10_2 <- c(0.0798097, 0.042286, 0.0256127, 0.0545377, 0.00647648, 0.0415941, 0.0664597, 0.05651, 0.0192085, 0.026212, 0.0674888, 0.060232, 0.0116261, 0.0276293, 0.180084, 0.108016, 0.0488319, 0.00927854, 0.0121215, 0.0559847)
F10_3 <- c(0.0470644, 0.201639, 0.0159705, 0.0173478, 0.00505199, 0.0272257, 0.0242141, 0.0298698, 0.0118394, 0.0227681, 0.0399091, 0.19112, 0.0127571, 0.103272, 0.0219969, 0.0376312, 0.0345976, 0.0162182, 0.0939447, 0.0455618)
F10_4 <- c(0.0694806, 0.0335526, 0.0328074, 0.177694, 0.00427499, 0.0395454, 0.220118, 0.0511172, 0.0152214, 0.0190148, 0.0374958, 0.0438818, 0.0111974, 0.0183089, 0.0395758, 0.0865666, 0.040649, 0.00994286, 0.0134577, 0.0360977)
F10_5 <- c(0.0596551, 0.0278387, 0.00609861, 0.00755908, 0.0313922, 0.0169838, 0.0139395, 0.014891, 0.011019, 0.172162, 0.119333, 0.0175854, 0.0186984, 0.0314716, 0.0201574, 0.0246769, 0.0369524, 0.0180101, 0.0234741, 0.328102)
F10_6 <- c(0.0766894, 0.0146108, 0.00637859, 0.00597544, 0.0191211, 0.0075268, 0.00902221, 0.0459491, 0.00439612, 0.108452, 0.415443, 0.0110997, 0.0402087, 0.0609875, 0.0101736, 0.0184603, 0.0241757, 0.0131422, 0.0148582, 0.0933296)
F10_7 <- c(0.0571653, 0.0536819, 0.0354733, 0.0457356, 0.0129715, 0.0520928, 0.0562981, 0.042851, 0.0211647, 0.0238535, 0.0429597, 0.0485451, 0.0106172, 0.0169971, 0.0167282, 0.168629, 0.195495, 0.00960914, 0.0140537, 0.0750785)
F10_8 <- c(0.126349, 0.0844151, 0.0361538, 0.0530762, 0.00583057, 0.089428, 0.124589, 0.0380624, 0.0165077, 0.0191689, 0.0639267, 0.120408, 0.0174217, 0.00805784, 0.0103541, 0.089876, 0.0434914, 0.00637643, 0.00930948, 0.037198)
F10_9 <- c(0.0701238, 0.0892763, 0.0333921, 0.0330027, 0.0254827, 0.0515682, 0.0553074, 0.0347178, 0.0757623, 0.0349972, 0.114966, 0.0346838, 0.0536732, 0.0459357, 0.0190074, 0.0723511, 0.0358203, 0.0204957, 0.0465509, 0.0528851)
F10_10 <- c(0.364355, 0.0212797, 0.0136395, 0.0110482, 0.0292781, 0.0243534, 0.0141053, 0.0640169, 0.0114759, 0.0246231, 0.0601335, 0.0179204, 0.0159828, 0.0294373, 0.0132395, 0.153465, 0.0474483, 0.00961209, 0.0130299, 0.0615561)

C10_1 <- c(0.4082573125, 0.0081783015, 0.0096285438, 0.0069870889, 0.0349388179, 0.0075279735, 0.0097846653, 0.1221613215, 0.0039151830, 0.0125784287, 0.0158338663, 0.0059670150, 0.0081313216, 0.0061604332, 0.0394155867, 0.1682450664, 0.0658132542, 0.0018751587, 0.0041579747, 0.0604426865)
C10_2 <- c(0.1027763487, 0.0418664491, 0.0213272051, 0.0155943616, 0.0149663448, 0.0440685478, 0.0419667447, 0.0138805792, 0.0158864807, 0.1066076641, 0.1131944125, 0.0436343681, 0.0437800327, 0.0180729309, 0.0223250701, 0.0529608087, 0.1081741005, 0.0045147205, 0.0137373857, 0.1606654446)
C10_3 <- c(0.0351766018, 0.0019678632, 0.0016591476, 0.0006768741, 0.0078706538, 0.0016559557, 0.0019686768, 0.0022420602, 0.0012878339, 0.3515819591, 0.1278183107, 0.0018856550, 0.0242631753, 0.0126221329, 0.0029771559, 0.0049998099, 0.0255378034, 0.0011907778, 0.0037539283, 0.3888636245)
C10_4 <- c(0.0408513927, 0.0269887074, 0.2185648186, 0.2333814790, 0.0037602852, 0.0380451418, 0.0901238869, 0.1158332065, 0.0373197176, 0.0025523644, 0.0052164616, 0.0485017266, 0.0022571778, 0.0025108218, 0.0108333610, 0.0804527209, 0.0302879995, 0.0010815260, 0.0069890931, 0.0044481118)
C10_5 <- c(0.0185492661, 0.0062362395, 0.0024895723, 0.0009775062, 0.0070416514, 0.0083539447, 0.0024891617, 0.0028952913, 0.0040103982, 0.1632422345, 0.4443079409, 0.0043570878, 0.1202815687, 0.0733329781, 0.0048827648, 0.0051642443, 0.0131806647, 0.0068759784, 0.0144734420, 0.0968580644)
C10_6 <- c(0.1106750119, 0.0352190043, 0.0405186210, 0.1636437899, 0.0014834855, 0.0877962201, 0.2638456592, 0.0325228293, 0.0163803600, 0.0068334902, 0.0140679579, 0.0677158208, 0.0048988133, 0.0023256777, 0.0298982139, 0.0562887953, 0.0426922497, 0.0010338979, 0.0040522304, 0.0181078719)
C10_7 <- c(0.0522657662, 0.0668294648, 0.0714836849, 0.0297745257, 0.0143324928, 0.0736540298, 0.0388386669, 0.0228101108, 0.1551638111, 0.0187406149, 0.0653779932, 0.0439469345, 0.0207189121, 0.0624033021, 0.0145475497, 0.0549017631, 0.0370140058, 0.0193756900, 0.1110694548, 0.0267512268)
C10_8 <- c(0.0116587342, 0.0050990142, 0.0064011054, 0.0021742457, 0.0105340743, 0.0040203734, 0.0024251112, 0.0034709143, 0.0366787049, 0.0187185330, 0.0676489746, 0.0026694717, 0.0143534813, 0.3650985596, 0.0031159927, 0.0094848536, 0.0073713920, 0.0509564551, 0.3574858593, 0.0206341497)
C10_9 <- c(0.0627195947, 0.2038782162, 0.0428629162, 0.0236193294, 0.0052662886, 0.1098111767, 0.0686284994, 0.0256174957, 0.0332612124, 0.0128968249, 0.0305627740, 0.2270839355, 0.0124036991, 0.0039181841, 0.0140440613, 0.0483152469, 0.0463378087, 0.0025143473, 0.0065521118, 0.0197062770)
C10_10 <- c(0.1145518598, 0.0324008908, 0.0750614981, 0.0416192189, 0.0098549497, 0.0339624663, 0.0364907910, 0.0503817581, 0.0165233329, 0.0092949460, 0.0139153707, 0.0423026886, 0.0082240805, 0.0046605982, 0.0379221548, 0.2610647896, 0.1845829279, 0.0017548981, 0.0058538316, 0.0195769483)

F1_1 <- c(0.0964, 0.0631, 0.0318, 0.0594, 0.0161, 0.0365, 0.0695, 0.0690, 0.0247, 0.0412, 0.1003, 0.0524, 0.0193, 0.0343, 0.0480, 0.0797, 0.0467, 0.0121, 0.0253, 0.0741)


# Add row names and column names to the matrix
profile_matrix <- rbind(F1_1,
                        F10_1, F10_2, F10_3, F10_4, F10_5, F10_6, F10_7, F10_8, F10_9, F10_10,
                        C10_1, C10_2, C10_3, C10_4, C10_5, C10_6, C10_7, C10_8, C10_9, C10_10)
rownames(profile_matrix) <- c("F1.1 (1.0000)",
                              "F10.1 (0.0999)", "F10.2 (0.0984)", "F10.3 (0.1004)", "F10.4 (0.0990)", "F10.5 (0.0988)", "F10.6 (0.1010)", "F10.7 (0.0992)", "F10.8 (0.1017)", "F10.9 (0.1014)", "F10.10 (0.1001)",
                              "C10.1 (0.1191)", "C10.2 (0.0874)", "C10.3 (0.1037)", "C10.4 (0.0923)", "C10.5 (0.1070)",
                              "C10.6 (0.1330)", "C10.7 (0.0538)", "C10.8 (0.0692)", "C10.9 (0.1320)", "C10.10 (0.1024)")

amino_acids <- c("A", "R", "N", "D", "C", "Q", "E", "G", "H", "I", "L", "K", "M", "F", "P", "S", "T", "W", "Y", "V")
colnames(profile_matrix) <- amino_acids

library(ggplot2)
library(ggrepel)
library(ggExtra)
library(cowplot)

# Extract weights and scale down to 50%
weights <- as.numeric(sub(".*\\((.*)\\)", "\\1", rownames(profile_matrix)))

# Extract labels, removing parentheses and weights within them
labels <- sub(" \\(.*\\)", "", rownames(profile_matrix))

# Create groups
groups <- sub("\\..*", "", labels)

# Perform PCA analysis
pca_result <- prcomp(profile_matrix, scale. = TRUE)

# Calculate the variance percentage explained by each principal component
explained_variance <- pca_result$sdev^2 / sum(pca_result$sdev^2)
percent_variance <- explained_variance * 100

# Prepare data frame for plotting
pca_data <- data.frame(pca_result$x, Weight = weights, Label = labels, Group = groups)

# Set groups as factors and define the order of groups
groups <- factor(groups, levels = c("F1", "F10", "C10"))

# Define colors for each group
colors <- c("F1" = "#5f5f5f", "F10" = "#2e974e", "C10" = "#2e7ebb")

# Plot the main PCA graph
pca_plot <- ggplot(pca_data, aes(x = PC1, y = PC2, label = Label, color = Group)) +
  geom_point(aes(size = Weight), alpha = 0.7) +
  geom_text_repel() +
  scale_size_continuous(range = c(1, 5)) +
  scale_color_manual(values = colors, name = "Group") +
  guides(size = guide_legend(title = "Weight")) +
  theme_minimal() +
  labs(
    x = paste0("PC1 (", round(percent_variance[1], 2), "%)"),
    y = paste0("PC2 (", round(percent_variance[2], 2), "%)"),
    size = "Weight",
    color = "Group") +
  theme(
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    legend.position = "none",  # Hide legend in PCA plot
    panel.grid.major = element_line(color = "gray80"),  # Major grid lines
    panel.grid.minor = element_line(color = "gray90"),  # Minor grid lines
    panel.border = element_rect(color = "black", fill = NA, size = 0.5),  # Border around plot area
    axis.line = element_line(color = "black")  # Axis lines
  )

# Create marginal density plot for PC1
density_pc1 <- ggplot(pca_data, aes(x = PC1, fill = Group, color = Group)) +
  geom_density(alpha = 0.5) +
  scale_color_manual(values = colors) +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 0.5),  # Add black border
    axis.line = element_line(color = "black"),
    legend.position = "none"  # Hide legend in density plot
  ) +
  labs(x = "PC1", y = "Density")

# Create marginal density plot for PC2
density_pc2 <- ggplot(pca_data, aes(x = PC2, fill = Group, color = Group)) +
  geom_density(alpha = 0.5) +
  scale_color_manual(values = colors) +
  scale_fill_manual(values = colors) +
  theme_minimal() +
  theme(
    panel.border = element_rect(color = "black", fill = NA, size = 0.5),  # Add black border
    axis.line = element_line(color = "black"),
    legend.position = "none"  # Hide legend in density plot
  ) +
  coord_flip() +  # Flip coordinates to align with PCA plot
  labs(x = "PC2", y = "Density")

# Extract legend and place it on the right side
legend_plot <- get_legend(
  ggplot(pca_data, aes(x = PC1, y = PC2, label = Label, color = Group)) +
    geom_point(aes(size = Weight), alpha = 0.7) +
    scale_color_manual(values = colors, name = "Group") +
    guides(size = guide_legend(title = "Weight")) +
    theme(legend.box.margin = margin(0, 0, 0, 12),
          legend.background = element_rect(fill = "white")) # Set white background and black border
)

# Combine PCA plot, marginal density plots, and legend using cowplot
combined_plot <- plot_grid(
  plot_grid(density_pc1, NULL, pca_plot, density_pc2,
            ncol = 2, nrow = 2,
            rel_heights = c(0.3, 1), rel_widths = c(1, 0.28),  # Narrow right-side marginal plot
            align = "hv"),
  legend_plot, # Place legend on the right side
  rel_widths = c(1, 0.15)  # Adjust relative width of legend and main plot
)

# Display the combined plot
print(combined_plot)
