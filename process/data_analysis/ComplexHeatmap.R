
# Input the data
F1_1 <- c(0.0910, 0.0509, 0.0343, 0.0552, 0.0174, 0.0375, 0.0634, 0.0740, 0.0266, 0.0448, 0.1045, 0.0535, 0.0198, 0.0383, 0.0469, 0.0911, 0.0442, 0.0095, 0.0259, 0.0714)
F2_1 <- c(0.111833, 0.0585401, 0.0361442, 0.0452503, 0.0164269, 0.0477722, 0.0736901, 0.0721632, 0.0355883, 0.0175871, 0.0776253, 0.0560464, 0.0177362, 0.0531232, 0.0386578, 0.113922, 0.0450682, 0.00652121, 0.0321773, 0.0441275)
F2_2 <- c(0.0562835, 0.0338915, 0.0279955, 0.0822954, 0.0208579, 0.0125582, 0.041598, 0.077748, 0.00465734, 0.0927915, 0.157652, 0.0500447, 0.0236334, 0.0144617, 0.0629659, 0.0460958, 0.0380497, 0.0212004, 0.0100036, 0.125215)
F3_1 <- c(0.0500968, 0.0661559, 0.000319176, 0.00216425, 0.0194053, 0.0181023, 0.0175704, 0.00208128, 0.000319176, 0.161733, 0.254591, 0.0523533, 0.0302065, 0.0219111, 0.0174585, 0.0027038, 0.0316781, 0.0167941, 0.00681486, 0.227542)
F3_2 <- c(0.136317, 0.047063, 0.0228457, 0.0617859, 0.0169848, 0.0365414, 0.0905201, 0.0427377, 0.0310131, 0.0220896, 0.0966618, 0.0304369, 0.0194049, 0.058794, 0.0344229, 0.110029, 0.0410663, 0.00674639, 0.0407815, 0.0537583)
F3_3 <- c(0.06748, 0.0565291, 0.0572676, 0.0625252, 0.0190248, 0.04535, 0.0477915, 0.135642, 0.0295822, 0.0282982, 0.0554757, 0.0816654, 0.0189998, 0.0157359, 0.0725652, 0.100411, 0.0537587, 0.0132793, 0.00934731, 0.0292711)
F4_1 <- c(0.0750844, 0.0498573, 0.022275, 0.0690164, 0.0301604, 0.0204666, 0.00740124, 0.0563608, 0.000190378, 0.138714, 0.171243, 0.0471392, 0.0284387, 0.0169531, 0.0217422, 0.0394125, 0.0370724, 0.0119705, 0.0207808, 0.135721)
F4_2 <- c(0.0875259, 0.0814659, 0.0503852, 0.0272808, 0.0265183, 0.0637486, 0.0458491, 0.103211, 0.0455511, 0.0243457, 0.0445635, 0.0675886, 0.0217247, 0.037134, 0.0232645, 0.105883, 0.0497492, 0.0119737, 0.0326566, 0.0495806)
F4_3 <- c(0.123465, 0.0431354, 0.0184182, 0.0647664, 0.00941364, 0.0360041, 0.0950604, 0.0260568, 0.032645, 0.0175506, 0.14137, 0.018433, 0.017703, 0.0651051, 0.018891, 0.120321, 0.0355932, 0.00720437, 0.0428244, 0.0660402)
F4_4 <- c(0.0840377, 0.0305739, 0.0408393, 0.0650042, 0.00564295, 0.0291985, 0.0880534, 0.0971233, 0.0166364, 0.0201273, 0.0752181, 0.0744412, 0.0182417, 0.0173594, 0.124656, 0.0861796, 0.0501723, 0.0126867, 8.93795e-005, 0.063719)
F5_1 <- c(0.143881, 0.0346053, 0.0182868, 0.0613595, 0.00473967, 0.0334946, 0.110895, 0.0252871, 0.0260651, 0.0173215, 0.150758, 0.0180763, 0.0178026, 0.0638737, 0.0252902, 0.1206, 0.029897, 0.00539726, 0.0343858, 0.0579829)
F5_2 <- c(0.0607215, 0.0928216, 0.0386315, 0.0273039, 0.0215929, 0.0633809, 0.0492109, 0.0982969, 0.0364318, 0.0274266, 0.0781391, 0.0737106, 0.0213992, 0.0435333, 0.0166337, 0.131398, 0.0508906, 0.0206413, 0.00137305, 0.0464628)
F5_3 <- c(0.104394, 0.0324212, 0.0446892, 0.0442816, 0.00543919, 0.0321524, 0.0861442, 0.118019, 0.0156122, 0.020909, 0.0668286, 0.0887116, 0.0247464, 6.57858e-005, 0.116537, 0.084656, 0.0490226, 0.00754791, 0.0109229, 0.0468989)
F5_4 <- c(0.0670671, 0.0624311, 0.00647171, 0.00992869, 0.0210759, 0.0187415, 0.0193588, 0.0221193, 0.000275171, 0.161579, 0.221618, 0.0514548, 0.0253512, 0.0261882, 0.0222543, 0.00784342, 0.0344464, 0.0120673, 0.0135581, 0.19617)
F5_5 <- c(0.0898421, 0.0426153, 0.0490051, 0.124841, 0.0387457, 0.0321599, 0.037151, 0.0876047, 0.0438731, 0.0305962, 0.030216, 0.029778, 0.00965078, 0.0545939, 0.0476735, 0.0859888, 0.0566263, 0.0057372, 0.0549875, 0.0483145)
F6_1 <- c(0.0447364, 0.0483921, 0.0654305, 0.132348, 0.0299156, 0.0376273, 0.0348806, 0.095282, 0.0387471, 0.0275882, 0.0247729, 0.0582983, 0.00201559, 0.0388068, 0.0324284, 0.128659, 0.0680638, 0.0150958, 0.0252022, 0.0517085)
F6_2 <- c(0.10555, 0.106768, 0.00797577, 0.00871086, 0.0119833, 0.0425989, 0.0453986, 0.0849799, 0.0208738, 0.0436755, 0.103213, 0.0944543, 0.0379581, 0.0398065, 0.00359614, 0.0984917, 0.0698759, 0.0153253, 8.23142e-005, 0.0586821)
F6_3 <- c(0.0626138, 0.020506, 0.00426682, 0.0252565, 0.0203636, 0.0172859, 0.0158249, 0.026261, 0.00902701, 0.177559, 0.229721, 0.0132141, 0.0234351, 0.0261985, 0.0263082, 0.00101343, 0.0272463, 0.0222099, 0.0368745, 0.214815)
F6_4 <- c(0.135394, 0.0456785, 0.0676246, 0.0116961, 0.0315671, 0.0582098, 0.0617962, 0.105185, 0.0399064, 0.0223078, 0.0746999, 0.0556639, 0.0333637, 0.0264103, 0.0379619, 0.0827239, 0.0235113, 0.0011937, 0.0383694, 0.0467365)
F6_5 <- c(0.0868965, 0.0286232, 0.0295088, 0.071412, 0.00243473, 0.0235711, 0.106378, 0.0918325, 0.0104235, 0.02065, 0.0738145, 0.078766, 0.0193554, 0.0143724, 0.157824, 0.0793546, 0.0471239, 0.00382745, 7.54042e-005, 0.0537559)
F6_6 <- c(0.125682, 0.0565661, 0.0159962, 0.0703122, 0.00852984, 0.0358802, 0.0964154, 0.0192819, 0.0317546, 0.013918, 0.142895, 0.00632368, 0.00830653, 0.0772216, 0.0262801, 0.128036, 0.0269427, 0.00769374, 0.0445758, 0.057388)
F7_1 <- c(0.0576435, 0.042277, 0.0280647, 0.0518481, 0.00571847, 0.0187935, 0.0993615, 0.105841, 0.00789338, 0.0349332, 0.0614669, 0.0904613, 0.017325, 0.0236904, 0.173815, 0.0808597, 0.0396404, 0.00995435, 7.06159e-005, 0.0503424)
F7_2 <- c(0.146864, 0.0168008, 0.0221099, 0.10084, 0.00212029, 0.0204462, 0.109527, 0.0467566, 9.66122e-005, 0.0276205, 0.0717892, 0.0423151, 0.0328043, 0.0610399, 9.66122e-005, 0.132294, 0.0458297, 0.00147654, 0.0502984, 0.0688752)
F7_3 <- c(0.0560409, 0.0380319, 0.0804914, 0.123779, 0.0321173, 0.0441612, 0.0287326, 0.125739, 0.0335132, 0.0265421, 0.0155149, 0.0655809, 0.000809493, 0.0259065, 0.0361337, 0.120222, 0.0688926, 0.0131196, 0.0117995, 0.0528716)
F7_4 <- c(0.0547522, 0.0691438, 0.0048756, 0.0183247, 0.0184315, 0.0259404, 0.0137261, 0.00140089, 0.000288006, 0.184199, 0.242513, 0.0585336, 0.0231457, 0.0219701, 0.00646358, 0.000288006, 0.0330585, 0.0137135, 0.0039102, 0.205321)
F7_5 <- c(0.061471, 0.0981959, 0.0204761, 0.0454412, 0.0323164, 0.0348272, 0.0803088, 0.0308945, 0.0678038, 0.028992, 0.101388, 0.0275439, 0.0101284, 0.0736355, 0.0184527, 0.125152, 0.03092, 0.0140912, 0.0499757, 0.0479864)
F7_6 <- c(0.1242, 0.0760588, 0.0489808, 0.00338429, 0.0109918, 0.068617, 0.0610741, 0.119752, 0.0342518, 0.0311028, 0.0784744, 0.0948355, 0.0370488, 7.22449e-005, 0.00299866, 0.0756581, 0.0428744, 0.0110418, 0.0270796, 0.0515037)
F7_7 <- c(0.15336, 0.033995, 0.0227142, 0.0360928, 0.0134893, 0.0527458, 0.0462861, 0.0560951, 0.0264938, 0.0139747, 0.175487, 8.70203e-005, 0.0170629, 0.0521138, 0.0944652, 0.0789056, 0.0479735, 0.0069217, 0.00969955, 0.0620371)
F8_1 <- c(0.0811378, 0.0997033, 0.0128704, 0.0271265, 0.0254703, 0.0779844, 0.0561354, 0.0322782, 0.0451639, 0.0105928, 0.115345, 0.0518907, 0.0142644, 0.0486127, 0.0358417, 0.130738, 0.0451412, 0.030558, 0.00335452, 0.0557906)
F8_2 <- c(0.131507, 0.0448557, 0.0775124, 0.0148096, 0.0203813, 0.0709775, 0.0615269, 0.123965, 0.0385015, 0.018815, 0.0691815, 0.0722386, 0.0378931, 0.00510669, 0.0391112, 0.0735393, 0.0209167, 0.00457269, 0.0343919, 0.0401967)
F8_3 <- c(0.0429145, 0.0659815, 0.00296994, 0.0159413, 0.0160083, 0.0268098, 0.0158725, 0.0047535, 0.000312427, 0.171864, 0.25091, 0.0582562, 0.0245191, 0.00873867, 0.0210525, 0.000312427, 0.0231426, 0.0205333, 0.00637827, 0.22273)
F8_4 <- c(0.207189, 0.0452386, 0.0108784, 0.000107188, 0.0167427, 0.00546062, 0.0292653, 0.0815291, 0.00120782, 0.0525783, 0.0985361, 0.0271672, 0.0423093, 0.0546842, 0.0207157, 0.0907483, 0.0827801, 0.00600925, 0.050438, 0.0764149)
F8_5 <- c(0.0224708, 0.0748061, 0.0540375, 0.057992, 0.0190974, 0.0126703, 0.0567849, 0.136786, 0.012372, 0.0761474, 0.0687827, 0.0719309, 0.0218068, 0.0574544, 0.0576011, 0.114416, 0.0330785, 0.00160633, 0.00119161, 0.0489666)
F8_6 <- c(0.130722, 0.0321876, 0.0210791, 0.084324, 0.000857866, 0.0297848, 0.117547, 0.0248797, 0.0325682, 0.0146122, 0.171381, 0.0160961, 0.00931093, 0.0668514, 0.0209997, 0.114074, 0.014309, 0.00515969, 0.0369029, 0.0563525)
F8_7 <- c(0.0583331, 0.0415012, 0.0554723, 0.16417, 0.0356191, 0.0316507, 0.0308299, 0.0730256, 0.0558693, 0.0265859, 0.00693724, 0.0388515, 7.45772e-005, 0.055051, 0.0276918, 0.103492, 0.0810163, 0.00952801, 0.0511338, 0.0531664)
F8_8 <- c(0.085612, 0.0196409, 0.026501, 0.0700168, 0.00487021, 0.030743, 0.114221, 0.0963927, 0.00963266, 0.0147949, 0.0678323, 0.0866532, 0.0199873, 7.80548e-005, 0.145315, 0.083399, 0.0608859, 0.00770014, 7.80548e-005, 0.0556456)

# Combine profiles into a matrix
profile_matrix <- rbind(F1_1, F2_1, F2_2, F3_1, F3_2, F3_3, F4_1, F4_2, F4_3, F4_4,
                        F5_1, F5_2, F5_3, F5_4, F5_5, F6_1, F6_2, F6_3, F6_4, F6_5, F6_6,
                        F7_1, F7_2, F7_3, F7_4, F7_5, F7_6, F7_7,
                        F8_1, F8_2, F8_3, F8_4, F8_5, F8_6, F8_7, F8_8)

# Add row and column names to the matrix
rownames(profile_matrix) <- c("F1.1 (1.0000)", "F2.1 (0.6409)", "F2.2 (0.3591)", "F3.1 (0.1553)", "F3.2 (0.4592)", "F3.3 (0.3855)",
                              "F4.1 (0.2462)", "F4.2 (0.2532)", "F4.3 (0.2498)", "F4.4 (0.2508)", "F5.1 (0.2039)", "F5.2 (0.2049)",
                              "F5.3 (0.2097)", "F5.4 (0.1823)", "F5.5 (0.1992)", "F6.1 (0.1687)", "F6.2 (0.1679)", "F6.3 (0.1545)",
                              "F6.4 (0.1665)", "F6.5 (0.1751)", "F6.6 (0.1672)", "F7.1 (0.1433)", "F7.2 (0.1433)", "F7.3 (0.1452)",
                              "F7.4 (0.1378)", "F7.5 (0.1433)", "F7.6 (0.1445)", "F7.7 (0.1426)",
                              "F8.1 (0.1276)", "F8.2 (0.1223)", "F8.3 (0.1241)", "F8.4 (0.1247)", "F8.5 (0.1223)", "F8.6 (0.1309)",
                              "F8.7 (0.1225)", "F8.8 (0.1257)")
amino_acids <- c("A", "R", "N", "D", "C", "Q", "E", "G", "H", "I", "L", "K", "M", "F", "P", "S", "T", "W", "Y", "V")
colnames(profile_matrix) <- amino_acids

library(ggtree)
library(ape)
library(ComplexHeatmap)
library(circlize)
library(viridis)

# Define KL divergence function
kl_dist <- function(p, q) {
  p <- p + 1e-10
  q <- q + 1e-10
  sum(p * log(p / q), na.rm = TRUE)
}

# Initialize KL divergence matrix
kl_matrix <- matrix(0, nrow(profile_matrix), nrow(profile_matrix))
rownames(kl_matrix) <- rownames(profile_matrix)
colnames(kl_matrix) <- rownames(profile_matrix)

# Calculate KL divergence between each pair of profiles
for(i in 1:nrow(profile_matrix)) {
  for(j in 1:nrow(profile_matrix)) {
    kl_matrix[i, j] <- kl_dist(profile_matrix[i, ], profile_matrix[j, ])
  }
}

# Perform clustering using the calculated KL divergence matrix
hc <- hclust(as.dist(kl_matrix), method = "complete")

#col_fun <- colorRamp2(c(min(profile_matrix), median(profile_matrix), max(profile_matrix)),c("#8FB4BE", "white", "#D93F49"))

# Create the heatmap
Heatmap(profile_matrix,
        cluster_rows = as.dendrogram(hc),  # Row clustering
        cluster_columns = TRUE,            # Column clustering
        show_row_dend = TRUE,              # Show row dendrogram
        show_column_dend = FALSE,          # Do not show column dendrogram
        row_dend_width = unit(4, "cm"),    # Adjust the width of the row dendrogram
        height = unit(12, "cm"),           # Increase the overall height of the heatmap
        heatmap_legend_param = list(title = "",
                                    labels_gp = gpar(fontsize = 8)),
        row_names_gp = gpar(fontsize = 8.5, fontfamily = "Helvetica"),
        column_names_gp = gpar(fontsize = 8.5, fontfamily = "Helvetica"),
        column_names_rot = 0,
        column_names_side = "bottom",  # Place the column labels at the bottom
        column_names_centered = TRUE,  # Center the column labels
        col = viridis(4)
)
