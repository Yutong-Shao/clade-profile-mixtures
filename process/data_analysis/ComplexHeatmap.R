
# Input the data
F1_1 <- c(0.0964, 0.0631, 0.0318, 0.0594, 0.0161, 0.0365, 0.0695, 0.0690, 0.0247, 0.0412, 0.1003, 0.0524, 0.0193, 0.0343, 0.0480, 0.0797, 0.0467, 0.0121, 0.0253, 0.0741)
F2_1 <- c(0.087416,0.0400479,0.0105975,0.00973127,0.0243297,0.0212822,0.018677,0.0339726,0.0216566,0.108033,0.20347,0.0218823,0.0318555,0.0675002,0.0164384,0.0353715,0.0357038,0.0166635,0.0432129,0.152158)
F2_2 <- c(0.0910478,0.0640341,0.0424837,0.0727085,0.00875975,0.0499729,0.0945052,0.0705988,0.0209904,0.0219905,0.0574736,0.0753122,0.0162473,0.0222082,0.0548882,0.111415,0.0552107,0.00920102,0.0144621,0.0464905)


F10_1 <- c(0.0537373, 0.0612638, 0.093546, 0.084053, 0.00935762, 0.0428651, 0.0637226, 0.174564, 0.0214135, 0.018647, 0.0296789, 0.0678227, 0.0115938, 0.0156217, 0.0319317, 0.127305, 0.0416943, 0.00867762, 0.0107713, 0.031733)
F10_2 <- c(0.0798097, 0.042286, 0.0256127, 0.0545377, 0.00647648, 0.0415941, 0.0664597, 0.05651, 0.0192085, 0.026212, 0.0674888, 0.060232, 0.0116261, 0.0276293, 0.180084, 0.108016, 0.0488319, 0.00927854, 0.0121215, 0.0559847)
F10_3 <- c(0.0470644, 0.201639, 0.0159705, 0.0173478, 0.00505199, 0.0272257, 0.0242141, 0.0298698, 0.0118394, 0.0227681, 0.0399091, 0.19112, 0.0127571, 0.103272, 0.0219969, 0.0376312, 0.0345976, 0.0162182, 0.0939447, 0.0455618)
F10_4 <- c(0.0694806, 0.0335526, 0.0328074, 0.177694, 0.00427499, 0.0395454, 0.220118, 0.0511172, 0.0152214, 0.0190148, 0.0374958, 0.0438818, 0.0111974, 0.0183089, 0.0395758, 0.0865666, 0.040649, 0.00994286, 0.0134577, 0.0360977)
F10_5 <- c(0.0596551, 0.0278387, 0.00609861, 0.00755908, 0.0313922, 0.0169838, 0.0139395, 0.014891, 0.011019, 0.172162, 0.119333, 0.0175854, 0.0186984, 0.0314716, 0.0201574, 0.0246769, 0.0369524, 0.0180101, 0.0234741, 0.328102)
F10_6 <- c(0.0766894, 0.0146108, 0.00637859, 0.00597544, 0.0191211, 0.0075268, 0.00902221, 0.0459491, 0.00439612, 0.108452, 0.415443, 0.0110997, 0.0402087, 0.0609875, 0.0101736, 0.0184603, 0.0241757, 0.0131422, 0.0148582, 0.0933296)
F10_7 <- c(0.0571653, 0.0536819, 0.0354733, 0.0457356, 0.0129715, 0.0520928, 0.0562981, 0.042851, 0.0211647, 0.0238535, 0.0429597, 0.0485451, 0.0106172, 0.0169971, 0.0167282, 0.168629, 0.195495, 0.00960914, 0.0140537, 0.0750785)
F10_8 <- c(0.126349, 0.0844151, 0.0361538, 0.0530762, 0.00583057, 0.089428, 0.124589, 0.0380624, 0.0165077, 0.0191689, 0.0639267, 0.120408, 0.0174217, 0.00805784, 0.0103541, 0.089876, 0.0434914, 0.00637643, 0.00930948, 0.037198)
F10_9 <- c(0.0701238, 0.0892763, 0.0333921, 0.0330027, 0.0254827, 0.0515682, 0.0553074, 0.0347178, 0.0757623, 0.0349972, 0.114966, 0.0346838, 0.0536732, 0.0459357, 0.0190074, 0.0723511, 0.0358203, 0.0204957, 0.0465509, 0.0528851)
F10_10 <- c(0.364355, 0.0212797, 0.0136395, 0.0110482, 0.0292781, 0.0243534, 0.0141053, 0.0640169, 0.0114759, 0.0246231, 0.0601335, 0.0179204, 0.0159828, 0.0294373, 0.0132395, 0.153465, 0.0474483, 0.00961209, 0.0130299, 0.0615561)

C2_1 <- c(0.087416,0.0400479,0.0105975,0.00973127,0.0243297,0.0212822,0.018677,0.0339726,0.0216566,0.108033,0.20347,0.0218823,0.0318555,0.0675002,0.0164384,0.0353715,0.0357038,0.0166635,0.0432129,0.152158)
C2_2 <- c(0.0910478,0.0640341,0.0424837,0.0727085,0.00875975,0.0499729,0.0945052,0.0705988,0.0209904,0.0219905,0.0574736,0.0753122,0.0162473,0.0222082,0.0548882,0.111415,0.0552107,0.00920102,0.0144621,0.0464905)

C10_1 <- c(0.4082573125, 0.0081783015, 0.0096285438, 0.0069870889, 0.0349388179, 0.0075279735, 0.0097846653, 0.1221613215, 0.0039151830, 0.0125784287, 0.0158338663, 0.0059670150, 0.0081313216, 0.0061604332, 0.0394155867, 0.1682450664, 0.0658132542, 0.0018751587, 0.0041579747, 0.0604426865)
C10_2 <- c(0.1027763487, 0.0418664491, 0.0213272051, 0.0155943616, 0.0149663448, 0.0440685478, 0.0419667447, 0.0138805792, 0.0158864807, 0.1066076641, 0.1131944125, 0.0436343681, 0.0437800327, 0.0180729309, 0.0223250701, 0.0529608087, 0.1081741005, 0.0045147205, 0.0137373857, 0.1606654446)
C10_3 <- c(0.0351766018, 0.0019678632, 0.0016591476, 0.0006768741, 0.0078706538, 0.0016559557, 0.0019686768, 0.0022420602, 0.0012878339, 0.3515819591, 0.1278183107, 0.0018856550, 0.0242631753, 0.0126221329, 0.0029771559, 0.0049998099, 0.0255378034, 0.0011907778, 0.0037539283, 0.3888636245)
C10_4 <- c(0.0408513927, 0.0269887074, 0.2185648186, 0.2333814790, 0.0037602852, 0.0380451418, 0.0901238869, 0.1158332065, 0.0373197176, 0.0025523644, 0.0052164616, 0.0485017266, 0.0022571778, 0.0025108218, 0.0108333610, 0.0804527209, 0.0302879995, 0.0010815260, 0.0069890931, 0.0044481118)
C10_5 <- c(0.0185492661, 0.0062362395, 0.0024895723, 0.0009775062, 0.0070416514, 0.0083539447, 0.0024891617, 0.0028952913, 0.0040103982, 0.1632422345, 0.4443079409, 0.0043570878, 0.1202815687, 0.0733329781, 0.0048827648, 0.0051642443, 0.0131806647, 0.0068759784, 0.0144734420, 0.0968580644)
C10_6 <- c(0.1106750119, 0.0352190043, 0.0405186210, 0.1636437899, 0.0014834855, 0.0877962201, 0.2638456592, 0.0325228293, 0.0163803600, 0.0068334902, 0.0140679579, 0.0677158208, 0.0048988133, 0.0023256777, 0.0298982139, 0.0562887953, 0.0426922497, 0.0010338979, 0.0040522304, 0.0181078719)
C10_7 <- c(0.0522657662, 0.0668294648, 0.0714836849, 0.0297745257, 0.0143324928, 0.0736540298, 0.0388386669, 0.0228101108, 0.1551638111, 0.0187406149, 0.0653779932, 0.0439469345, 0.0207189121, 0.0624033021, 0.0145475497, 0.0549017631, 0.0370140058, 0.0193756900, 0.1110694548, 0.0267512268)
C10_8 <- c(0.0116587342, 0.0050990142, 0.0064011054, 0.0021742457, 0.0105340743, 0.0040203734, 0.0024251112, 0.0034709143, 0.0366787049, 0.0187185330, 0.0676489746, 0.0026694717, 0.0143534813, 0.3650985596, 0.0031159927, 0.0094848536, 0.0073713920, 0.0509564551, 0.3574858593, 0.0206341497)
C10_9 <- c(0.0627195947, 0.2038782162, 0.0428629162, 0.0236193294, 0.0052662886, 0.1098111767, 0.0686284994, 0.0256174957, 0.0332612124, 0.0128968249, 0.0305627740, 0.2270839355, 0.0124036991, 0.0039181841, 0.0140440613, 0.0483152469, 0.0463378087, 0.0025143473, 0.0065521118, 0.0197062770)
C10_10 <- c(0.1145518598, 0.0324008908, 0.0750614981, 0.0416192189, 0.0098549497, 0.0339624663, 0.0364907910, 0.0503817581, 0.0165233329, 0.0092949460, 0.0139153707, 0.0423026886, 0.0082240805, 0.0046605982, 0.0379221548, 0.2610647896, 0.1845829279, 0.0017548981, 0.0058538316, 0.0195769483)


LG <- c(0.07906592, 0.05594094, 0.04197696, 0.05305195, 0.01293699, 0.04076696, 0.07158593, 0.05733694, 0.02235498, 0.06215694, 0.0990809, 0.06459994, 0.02295098, 0.04230196, 0.04403996, 0.06119694, 0.05328695, 0.01206599, 0.03415497, 0.06914693)

WAG <- c(0.08662791, 0.043972, 0.0390894, 0.05704511, 0.0193078, 0.0367281, 0.05805891, 0.08325181, 0.0244313, 0.048466, 0.08620901, 0.06202861, 0.0195027, 0.0384319, 0.0457631, 0.06951791, 0.06101271, 0.0143859, 0.07089561)

JTT <- c(0.07674792, 0.05169095, 0.04264496, 0.05154395, 0.01980298, 0.04075196, 0.06182994, 0.07315193, 0.02294398, 0.05376095, 0.09190391, 0.05867594, 0.02382598, 0.04012596, 0.05090095, 0.06876493, 0.05856494, 0.01426099, 0.03210197, 0.06600493)



# Add row names and column names to the matrix
profile_matrix <- rbind(F1_1 #,WAG, LG
                        ,F2_1, F2_2
                        #,F4_1, F4_2, F4_3, F4_4
                        #,F8_1, F8_2, F8_3, F8_4, F8_5, F8_6, F8_7, F8_8
                        ,F10_1, F10_2, F10_3, F10_4, F10_5, F10_6, F10_7, F10_8, F10_9, F10_10
                        #, C2_1, C2_2
                        ,C10_1, C10_2, C10_3, C10_4, C10_5, C10_6, C10_7, C10_8, C10_9, C10_10
                        #F20_1, F20_2, F20_3, F20_4, F20_5, F20_6, F20_7, F20_8, F20_9, F20_10, F20_11, F20_12, F20_13, F20_14, F20_15, F20_16, F20_17, F20_18, F20_19, F20_20
)
rownames(profile_matrix) <- c("F1.1 (1.0000)"
                              , "F2.1 (0.2758)", "F2.2 (0.7242)"
                              , "F10.1 (0.0999)", "F10.2 (0.0984)", "F10.3 (0.1004)", "F10.4 (0.0990)", "F10.5 (0.0988)", "F10.6 (0.1010)", "F10.7 (0.0992)", "F10.8 (0.1017)", "F10.9 (0.1014)", "F10.10 (0.1001)"
                              #, "F'2.1 (0.2758)", "F'2.2 (0.7242)"
                              #, "F'10.1 (0.0999)", "F'10.2 (0.0984)", "F'10.3 (0.1004)", "F'10.4 (0.0990)", "F'10.5 (0.0988)", "F'10.6 (0.1010)", "F'10.7 (0.0992)", "F'10.8 (0.1017)", "F'10.9 (0.1014)", "F'10.10 (0.1001)"
                              ,"C10.1 (0.1191)", "C10.2 (0.0874)", "C10.3 (0.1037)", "C10.4 (0.0923)", "C10.5 (0.1070)",
                              "C10.6 (0.1330)", "C10.7 (0.0538)", "C10.8 (0.0692)", "C10.9 (0.1320)", "C10.10 (0.1024)"
                              #"F20.1 (0.0505)", "F20.2 (0.0507)", "F20.3 (0.0492)", "F20.4 (0.0500)", "F20.5 (0.0505)",
                              #"F20.6 (0.0505)", "F20.7 (0.0506)", "F20.8 (0.0497)", "F20.9 (0.0504)", "F20.10 (0.0503)",
                              #"F20.11 (0.0494)", "F20.12 (0.0495)", "F20.13 (0.0494)", "F20.14 (0.0490)", "F20.15 (0.0507)",
                              #"F20.16 (0.0493)", "F20.17 (0.0500)", "F20.18 (0.0502)", "F20.19 (0.0501)", "F20.20 (0.0500)"
)
amino_acids <- c("A", "R", "N", "D", "C", "Q", "E", "G", "H", "I", "L", "K", "M", "F", "P", "S", "T", "W", "Y", "V")
colnames(profile_matrix) <- amino_acids

library(ggtree)
library(ape)
library(ComplexHeatmap)
library(circlize)
library(viridis)

# Define KL divergence function
kl_dist <- function(p, q) {
  p <- p + 1e-10
  q <- q + 1e-10
  sum(p * log(p / q), na.rm = TRUE)
}

# Initialize KL divergence matrix
kl_matrix <- matrix(0, nrow(profile_matrix), nrow(profile_matrix))
rownames(kl_matrix) <- rownames(profile_matrix)
colnames(kl_matrix) <- rownames(profile_matrix)

# Calculate KL divergence between each pair of profiles
for(i in 1:nrow(profile_matrix)) {
  for(j in 1:nrow(profile_matrix)) {
    kl_matrix[i, j] <- kl_dist(profile_matrix[i, ], profile_matrix[j, ])
  }
}

# Perform clustering using the calculated KL divergence matrix
hc <- hclust(as.dist(kl_matrix), method = "complete")


# Plot One: The ComplexHeatmap Plot
# Define colors for each group
group_colors <- c("F1" = "red",
                  "F10" = "darkgreen",
                  "F'10" = "darkgreen",
                  "F'2" = "black",
                  "C10" = "purple",
                  "F2" = "black"
                  ,"F4" = "black"
                  ,"WAG" = "black","LG" = "black"
                  ,"F8" = "black"
                  #"F20" = "darkgreen"
                  )

# Extract groups from the row names
group_labels <- sub("\\..*", "", rownames(profile_matrix))  # Extract the F group

# Create a vector of colors corresponding to the groups
row_colors <- group_colors[group_labels]

# Create the heatmap with adjusted row height
Heatmap(profile_matrix,
        cluster_rows = as.dendrogram(hc),  # Row clustering
        cluster_columns = TRUE,            # Column clustering
        show_row_dend = TRUE,              # Show row dendrogram
        show_column_dend = FALSE,          # Do not show column dendrogram
        row_dend_width = unit(3, "cm"),    # Adjust the width of the row dendrogram
        row_gap = unit(1, "mm"),           # Increase space between rows
        #height = unit(17, "cm"),           # Increase the overall height of the heatmap
        heatmap_legend_param = list(title = "",
                                    labels_gp = gpar(fontsize = 8)),
        row_names_gp = gpar(fontsize = 8.5, fontfamily = "Helvetica", col = row_colors),  # Apply the color to row labels
        column_names_gp = gpar(fontsize = 8.5, fontfamily = "Helvetica"),
        column_names_rot = 0,
        column_names_side = "bottom",  # Place the column labels at the bottom
        column_names_centered = TRUE,  # Center the column labels
        col = viridis(4)
)

